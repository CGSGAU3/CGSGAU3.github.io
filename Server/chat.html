<!DOCTYPE html>

<head>
    <meta charset="UTF_8" />
    <title>Sample hosted HTML</title>
    <link rel="stylesheet" href="./styles.css">
    <td class="a">Input message <input id="msg" size="5" onkeyup="changeMessage()"></td>
    <button onmousedown="sendMessage()">Send Message</button>
    <button onmousedown="getMessages()">Get Messages</button>
    <script type="text/javascript">
        var usn = prompt("Input your name: ");
        var msg;
        var Messages = [];
        var NumOfMessages = 0;

        function changeMessage() {
            msg = document.getElementById("msg").value;
        }

        function sendMessage() {
            if (msg[0] !== 0 && msg[0] !== ' ') {
                fetch("/newMessage", { method: 'POST', body: usn + ": " + msg });
            }
        }

        function getMessages() {
            fetch("/getMessage", { method: 'GET' });
        }

        async function getMessage() {
            try {
                const responce = await window.fetch("/getMessage");
                if (!responce.ok)
                    throw new Error(`Response status is: ${response.status}`);
                const cmsg = await responce.text();
                if (cmsg[0] > 32)
                    Messages[NumOfMessages++] = cmsg;
            } catch (err) {
                Messages[NumOfMessages++] = err.message, NumOfMessages++;
            }
            for (let i = 0; i < NumOfMessages; i++) {
                var tag = document.createElement("p");
                var text = document.createTextNode(Messages[i]);
                tag.appendChild(text);
                var element = document.getElementById("chat");
                element.appendChild(tag);
            }
            setTimeout(getMessage, 500);
        }

        function initChat() {
            setTimeout(getMessage, 500);
            msg = "Hello World";
            sendMessage();
        }
    </script>
</head>

<body onload="initChat()">
    <div id="chat">
    </div>
</body>

</html>